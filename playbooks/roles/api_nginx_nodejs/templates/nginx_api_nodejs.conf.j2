# IP which nodejs is running on
upstream app_x {
    server 127.0.0.1:{{ node_port }};
}

# nginx server instance
server {
    listen 80;

    server_name {{ nginx_server_name }};

    access_log {{ log_file_access }};

    location / {
        root /var/www/x/public;
        index index.html index.htm index.php;
        try_files $uri $uri/ @node;
    }

    # proxy_pass to the upstream node app. 
    # use X-Forwarded-For when proxying so we can see where the req came from
    location @node {
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass http://app_x;
    }
}
